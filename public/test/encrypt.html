<!doctype html>
<html lang="de">
<meta charset="utf-8" />
<title>AES-GCM Test-Payload Generator</title>
<style>
  body{font-family:system-ui,sans-serif;max-width:720px;margin:2rem auto;}
  textarea,input{width:100%;font-family:ui-monospace,Consolas,monospace}
  textarea{height:140px}.row{margin:1rem 0}button{padding:.6rem 1rem;cursor:pointer}
  pre{background:#f5f5f5;padding:.75rem;overflow:auto}
</style>
<h1>AES-GCM Payload Generator</h1>
<div class="row">
  <label>AES_KEY_B64 (wie in Vercel gesetzt):</label>
  <input id="key" placeholder="Base64-String (32 Byte)" />
</div>
<div class="row">
  <label>JSON Klartext (wird verschl√ºsselt):</label>
  <textarea id="plain">{ "hello": "world", "n": 42 }</textarea>
</div>
<div class="row"><button id="gen">Payload erzeugen</button></div>
<div class="row">
  <label>Result (iv, ct, ts):</label>
  <pre id="out"></pre>
</div>
<script>
  const b64ToU8 = b64 => Uint8Array.from(atob(b64), c => c.charCodeAt(0));
  const u8ToB64 = u8 => btoa(String.fromCharCode(...u8));
  document.getElementById('gen').onclick = async () => {
    try {
      const keyB64 = document.getElementById('key').value.trim();
      const data = JSON.parse(document.getElementById('plain').value);
      if (!keyB64) { alert('Bitte AES_KEY_B64 eintragen.'); return; }
      const key = await crypto.subtle.importKey('raw', b64ToU8(keyB64), 'AES-GCM', false, ['encrypt']);
      const iv = crypto.getRandomValues(new Uint8Array(12));
      const pt = new TextEncoder().encode(JSON.stringify(data));
      const ct = new Uint8Array(await crypto.subtle.encrypt({ name: 'AES-GCM', iv }, key, pt));
      const payload = { v: 1, iv: u8ToB64(iv), ct: u8ToB64(ct), ts: Date.now() };
      document.getElementById('out').textContent = JSON.stringify(payload, null, 2);
    } catch (e) { alert('Fehler: ' + e); }
  };
</script>
